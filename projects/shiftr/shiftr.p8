pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
-- shiftr
-- by neil popham

pad={left=0,right=1,up=2,down=3,btn1=4,btn2=5}
dir={left=1,right=2}
drag={air=1,ground=0.25,gravity=0.75}

#include functions.lua
#include mapdata.lua
#include particles.lua
#include tiles.lua
#include objects.lua
#include entities.lua
#include collections.lua

-- globals
portals=collection:create()
enemies=collection:create()
particles=collection:create()
entities={}

-- turn placeholders into objects
function placeholders()
 local s
 for ty=0,15 do
  for tx=0,15 do
   s,x,y=mget(tx,ty),tx*8,ty*8
   if s==2 then
    p=player:create(x,y)
    add(entities,p)
    mset(tx,ty,0)
   elseif s==3 then
    local e=enemy:create(x,y)
    enemies:add(e)
    add(entities,e)
    mset(tx,ty,0)
   elseif s==4 then
    b=block:create(x,y)
    add(entities,b)
    mset(tx,ty,0)
   elseif s==5 then
    d=door:create(x,y)
    add(entities,d)
    mset(tx,ty,0)
   elseif s==7 then
    local r=portal:create(x,y)
    portals:add(r)
    add(entities,r)
    mset(tx,ty,0)
    mset(tx,ty+1,6)
   end
  end
 end
end

function _init()
 printh("####")
 printh("init")
 printh("####")
 --mapdata:decompress()
 --mapdata:load(1)
 tile:init()
 placeholders()
end

function _update60()
 tile:update()
 portals:update()
 p:update()
 enemies:update()
 b:update()
 d:update()
 particles:update()
end

function _draw()
 cls()
 rectfill(0,0,63,63,1)
 rectfill(64,64,127,127,1)
 tile:draw()
 d:draw()
 b:draw()
 portals:draw()
 enemies:draw()
 p:draw()
 particles:draw()

 --[[
 for pane in all(tile.panes) do
  print(pane.x..","..pane.y.." ("..pane.map.x..","..pane.map.y..")",pane.tile.x*64-64,pane.tile.y*64-64,3)
 end
 ]]

end

__gfx__
0000000077777776000000000000000099999999ccccccccaaaaaaa9000000001000000100000000000000001cc77cc1cccccccc00000000aaaaaaa900000000
000000007666666d0bbbb3300000007c94644642cccccccca9999994000000000000000000000000000000001cc77cc1cccccccc00000000a999999400000000
000000007666666dbbbb777c0000087142222222cccccccc94444444000000000000000000000000000000001cc77cc1cccccccc00000000a999999400000000
000000007666666dbbbb71718288287194444442cccccccc6ddddddd000000000001100000000000000000001cc77cc1cccccccc00000000a999999400000b30
000000007666666dbbbb777c8288287c94444442cccccccc7666666d000000000001100000000000000000001cc77cc1cccccccc00000000a99999940000bbb3
000000007666666dbbbbbb338288288299999999cccccccc7666666d000000000000000000000000aaaaaaa91cc77cc1cccccccc00000000a999999400003b33
000000007666666d3bbbb3338288288294644642cccccccc7666666d000000000000000000000000a99999941cc77cc1cccccccc00000000a99999940006d330
000000006ddddddd333333332222222242222222cccccccc6ddddddd3bb77bb31000000100000000944444441cc77cc1cccccccc00000000944444440006d000
99999999000000000bbbb33000000000000000000bbbb33000000000000000000000007c0000027c000000007c0000007c80000000000000777c777c00000000
946446420bbbb330bbbb777c000000000bbbb330777cbb33000000000000007c00000871000282717c0000001c2000001c8280000007777c711c711c7c77c000
42222222bbbb777cbbbb71710bbbb330777cbb33171cbb330bbbb3300000087100282871008282711c2000001c2828001c82820002871111711c711c1111c280
94444442bbbb7171bbbb777cbbbb777c171cbb33777cbb33777cbb33828828710828287c0082827c1c2882827c2828207c8282008287111177cc77cc1111c282
94444442bbbb777cbbbbbb33bbbb7171777cbb33bbbbbb33171cbb338288287c08282882008282827c288282882828208282820082877ccc888888827c77c282
99999999bbbbbb33bbbbbb33bbbb777cbbbbbb33bbbbbb33777cbb33828828820828288200828282882882828828282082828200828282228822228222828282
946446423bbbb3333bbbb3333bbbb3333bbbb3333bbbb3333bbbb333828828820828288200828282882882828828282082828200828288828888888288828282
42222222333333333333333333333333333333333333333333333333222222220222222200222222222222222222222022222200222222222222222222222222
000000000bbbb3300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bbbb330777c777c0bbbb33000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bb777c7c711c711c77c77c3300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bb711c1c777c777c71c11c3300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bb777c7cbbbbbb3377c77c3300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbb33bbbbbb33bbbbbb3300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3bbbb3333bbbb3333bbbb33300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333333333333333333300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000940000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
08200000009994000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
88820000009944000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
28220000000440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
022dd000000dd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0006d0000006d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0001000000000100010000010000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000700000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010100000000010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000010300000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000003050000000007000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000001010101000001010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000010000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
