pico-8 cartridge // http://www.pico-8.com
version 23
__lua__
-- shiftr
-- by neil popham

pad={left=0,right=1,up=2,down=3,btn1=4,btn2=5}
dir={left=1,right=2}
drag={air=1,ground=0.25,gravity=0.75}

#include debug.lua
#include functions.lua
#include mapdata.lua
#include particles.lua
#include tiles.lua
#include objects.lua
#include entities.lua
#include collections.lua
#include stages.lua

-- globals
portals=collection:create()
enemies=collection:create()
particles=collection:create()
lifts=collection:create()
fryers=collection:create()
entities={}

-- turn placeholders into objects
function placeholders()
 local i,s=0
 for ty=0,15 do
  for tx=0,15 do
   s,x,y=mget(tx,ty),tx*8,ty*8
   if s==2 then
    p=player:create(x,y)
    add(entities,p)
    mset(tx,ty,0)
   elseif s==3 then
    local e=enemy:create(x,y)
    enemies:add(e)
    add(entities,e)
    mset(tx,ty,0)
   elseif s==4 then
    b=block:create(x,y)
    add(entities,b)
    mset(tx,ty,0)
   elseif s==5 then
    d=door:create(x,y)
    add(entities,d)
    mset(tx,ty,0)
   elseif s==7 then
    local s2=mget(tx,ty+1)
    local index=s2>1 and s2 or i\2
    local r=portal:create(x,y,index)
    i+=1
    portals:add(r)
    add(entities,r)
    mset(tx,ty,0)
    mset(tx,ty+1,16)
   elseif s==8 then
    local l=lift:create(x,y)
    lifts:add(l)
    add(entities,l)
    mset(tx,ty,0)
   elseif s==9 then
    local f=fryer:create(x,y)
    fryers:add(f)
    add(entities,f)
    mset(tx,ty,1)
   end
  end
 end
end

function _init()
 printh("==== _init() ====")
 --reload(0x2000,0x2000,0x1000,'maps/level-02.p8')
 stage=stage_main
 stage:init()
end

function _update60()
 stage:update()
end

function _draw()
 cls()
 stage:draw()
 stages:draw()
end



__gfx__
0000000077777776000000000000000099999999cccccccc0000000000000000677777667777777c000000000000000000000000000000000009900000999000
000000007666666d0bbbb3300000007c96444462cccccccc0000000000000000d67666dd7cccccc1000000000000000000000000000000000000900000000900
000000007666666dbbbb777c0000087142222222cccccccc0000000000000000d67666ddc1111111000000000000000000000000000000000000900000099000
000000007666666dbbbb71718288287194444442cccccccc00000000000000002efeee226ddddddd000000000000000000000000000000000000900000900000
000000007666666dbbbb777c8288287c94444442cccccccc00000000000000002efeee227666666d000000000000000000000000000000000099990000999900
000000007666666dbbbbbb338288288299999999cccccccc00000000000000002efeee227666666d000000000000000000000000000000000000000000000000
000000007666666d3bbbb3338288288296444462cccccccc0000000000000000000000007666666d000000000000000000000000000000000000000000000000
000000006ddddddd333333332222222242222222cccccccc000000003bb77bb3000000006ddddddd000000000000000000000000000000000000000000000000
aaaaaaa9000000000bbbb33000000000000000000bbbb33000000000000000000000007c0000027c000000007c0000007c80000000000000777c777c00000000
a99999940bbbb330bbbb777c000000000bbbb330777cbb33000000000000007c00000871000282717c0000001c2000001c8280000007777c711c711c7c77c000
94444444bbbb777cbbbb71710bbbb330777cbb33171cbb330bbbb3300000087100282871008282711c2000001c2828001c82820002871111711c711c1111c280
6dddddddbbbb7171bbbb777cbbbb777c171cbb33777cbb33777cbb33828828710828287c0082827c1c2882827c2828207c8282008287111177cc77cc1111c282
7666666dbbbb777cbbbbbb33bbbb7171777cbb33bbbbbb33171cbb338288287c08282882008282827c288282882828208282820082877ccc888888827c77c282
7666666dbbbbbb33bbbbbb33bbbb777cbbbbbb33bbbbbb33777cbb33828828820828288200828282882882828828282082828200828282228822228222828282
7666666d3bbbb3333bbbb3333bbbb3333bbbb3333bbbb3333bbbb333828828820828288200828282882882828828282082828200828288828888888288828282
6ddddddd333333333333333333333333333333333333333333333333222222220222222200222222222222222222222022222200222222222222222222222222
000000000bbbb3300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bbbb330777c777c0bbbb33000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bb777c7c711c711c77c77c3300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bb711c1c777c777c71c11c3300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bb777c7cbbbbbb3377c77c3300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbbbbb33bbbbbb33bbbbbb3300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3bbbb3333bbbb3333bbbb33300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33333333333333333333333300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000007777777aeeeeeee87777777ceeeeeee800000000aaaaaaa90000000000000000000000000000000000000000000000000000000000000000
00000000000000007aaaaaa9e88888827cccccc1e888888200000000a99999940000000000000000000000000000000000000000000000000000000000000000
00000000000940007aaaaaa982222222c11111118222222200000000a99999940000000000000000000000000000000000000000000000000000000000000000
08200000009994007aaaaaa96ddddddd6dddddddd67666dd00000000a99999940000000000000000000000000000000000000000000000000000000000000000
88820000009944007aaaaaa97666666d7666666dd67666dd00000000a99999940000000000000000000000000000000000000000000000000000000000000000
28220000000440007aaaaaa97666666d7666666dd67666ddaaaaaaa9a99999940000000000000000000000000000000000000000000000000000000000000000
022dd000000dd0007aaaaaa97666666d7666666d00000000a9999994a99999940000000000000000000000000000000000000000000000000000000000000000
0006d0000006d000a99999996ddddddd6ddddddd0000000094444444944444440000000000000000000000000000000000000000000000000000000000000000
__gff__
0001000000000000010100000000000001000000000000000000000000000000000000000000000000000000000000000000000101010001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101090000010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0300000500000000000007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
010101010101010001010e010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000070000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01010e0101010108010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
