pico-8 cartridge // http://www.pico-8.com
version 42
__lua__

-- ‚¨ÖÔ∏è‚û°Ô∏è‚¨ÜÔ∏è‚¨áÔ∏èüÖæÔ∏è‚ùé

function mrnd(x,f)
    if f==nil then f=true end
    local r=x[1]+rnd((f and 1 or 0)+x[2]-x[1])
    return f and flr(r) or r
end

function range(n,m)
    return mrnd({n,m})
end

o={}

pixel={
    create=function(self,x,y,dir)
        local o=setmetatable(
            {
                x=x,
                y=y,
                dir=dir
            },
            self
        )
        self.__index=self
        return o
    end
}

frog={
    create=function(self,x,y,dir)
        local o=pixel.create(self,x,y,dir)
        -- o.dir=dir
        o.c=3
        o:reset()
        return o
    end,
    reset=function(self)
        self.t=0
        self.stage=0
        self.range=range(12,16)
    end,
    turn=function(self)
        self.dir=self.dir==1 and -1 or 1
    end,
    update=function(self)
        if self.stage==0 then return end
        -- _ENV=self
        local dx,dy,x,y,tx,ty,tile
        if self.stage==1 then
            dx=2*self.dir
            dy=-1
            if self.t==0 then
                tx=flr((self.x+(self.dir==1 and 8 or -8))/8)
                ty=flr(self.y/8)
                tile=mget(tx,ty)
                if fget(tile,0) then self:turn() end
            end
        else
            dx=self.stage==2 and self.dir or 0
            dy=1
        end
        x=self.x+(2*self.dir)
        y=self.y+(self.stage==1 and -2 or 2)
        tx=flr((x+dx)/8)
        ty=flr((y+dy)/8)
        tile=mget(tx,ty)
        if fget(tile,0) then
            tile=mget(flr(x/8),ty)
            if fget(tile,0) then
                if self.stage==1 then
                    self.y=ty*8+8
                else
                    self.y=ty*8-1
                    self:reset()
                end
            end
            tile=mget(tx,flr(y/8))
            if fget(tile,0) then
                self.x=tx*8+(self.dir==1 and -3 or 10)
                -- if self.stage==1 then
                --     if self.t<6 then self:turn() end
                -- end
            end
            if self.stage>0 then self.stage=3 end
            dx=0
            dy=0
        end
        self.x+=dx
        self.y+=dy
        self.x=self.x%128
        if self.stage==1 then
            self.t+=1
            if self.t==self.range then
                self.stage=2
            end
        end
    end,
    draw=function(self)
        local ex=self.x+2*self.dir
        if self.stage==0 then
            line(self.x, self.y, self.x+1, self.y, self.c)
            pset(self.x+(self.dir==1 and 1 or 0),self.y-1,self.c)
        elseif self.stage==1 then
            line(self.x, self.y, ex,self.y-2,self.c)
        else
            line(self.x, self.y, ex,self.y+2,self.c)
        end
    end
}

-- entities={}
-- add(entities, frog:create(0,119))

f=frog:create(0,63,1)

function _init()

end

function _update60()
    -- ‚¨ÖÔ∏è‚û°Ô∏è‚¨ÜÔ∏è‚¨áÔ∏èüÖæÔ∏è‚ùé

    if btn(‚¨ÖÔ∏è) then
        f.x-=1
        f.dir=-1
    end
    if btn(‚û°Ô∏è) then
        f.x+=1
        f.dir=1
    end
    if btnp(üÖæÔ∏è) and f.stage==0 then
        f.stage=1
    end
    if btnp(‚ùé) then
        f.dir=f.dir==1 and -1 or 1
    end

    if f.stage==0 then f.stage=1 end

    f:update()
end

function _draw()
    cls()
    map(0,0)
    print(f.x,0,0,7)
    print(f.y,16,0,7)
    print(f.stage,32,0,7)
    f:draw()
end
__gfx__
00000000777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000777777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001000000000001000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001000000000001010101000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010100010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000001010000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000001010000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000001010000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000001010000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000001010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
