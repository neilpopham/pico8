pico-8 cartridge // http://www.pico-8.com
version 43
__lua__

for l=0,4 do
    for r=0,15 do
        memcpy(0x8000+(16*r)+(128*l),0x2000+(16*l)+(128*r),16)
    end
end

-- memcpy(0x8000,0x2000,2048)
poke(0x5f56,0x8000)
poke(0x5f57,16)
-- for i=0,1024 do poke(0x8000+i,i%3+1) end

function _init()
    level=1
    x=60
    y=88
    dx=0
    dy=0
    follow=true
end

function _update60xxx()
    if btn(0) then dx-=1 end
    if btn(1) then dx+=1 end
    dx=mid(-4,dx,4)
    dx*=.7
    local hit=false
    local tx=(x+dx+(dx>0 and 7 or 0))\8
    for ty in all({y%128\8,(y%128+7)\8}) do
        local s=mget(tx+(level-1)*16,ty)
        if fget(s,0) then
            hit=true
            break
        end
    end
    if hit then
        x=tx*8+(dx>0 and -8 or 8)
        dx=0
    end
    x+=dx

    if btn(4) then dy-=1 end
    dy+=.3
    dy=mid(-4,dy,4)
    hit=false
    local ty=(y%128+dy+(dy>0 and 7 or 0))\8
    for tx in all({x\8,(x+7)\8}) do
        local s=mget(tx+(level-1)*16,ty)
        if fget(s,0) then
            hit=true
            break
        end
    end
    if hit then
        y=ty*8+(level-1)*-128+(dy>0 and -8 or 8)
        dy=0
    end
    y+=dy
    level=ceil(y/-128)+1

    if btnp(5) then follow=not follow end
end

function _update()
    if btn(5) then y+=1 end
end

function _draw()
    cls(0)
    if follow then
        camera(0,y-64)
    else
        camera(0,(level-1)*-128)
    end
    map(0,0,0,0)
    -- spr(6,x,y)
    -- camera(0,0)
    -- print('l'..level,2,1,7)
end

__gfx__
00000000111111112222222233333333444444445555555577777777000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111112222222233333333444444445555555577777777000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111112222222233333333444444445555555577777777000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111112222222233333333444444445555555577777777000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111112222222233333333444444445555555577777777000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111112222222233333333444444445555555577777777000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111112222222233333333444444445555555577777777000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111112222222233333333444444445555555577777777000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0001010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0101010000000000000000000001010102020200000000000000000000020202030303000000000000000000000303030404040000000000000000000004040405050505050505050505050505050505000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000102000000000000000000000000000002030000000000000000000000000000030400000000000000000000000000000405000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000010101010101000000000102000000000202020202020000000002030000000003030303030300000000030400000000040404040404000000000405000000000505050505050000000005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000102000000000000000000000000000002030000000000000000000000000000030400000000000000000000000000000405000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000102000000000000000000000000000002030000000000000000000000000000030400000000000000000000000000000405000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000102000000000000000000000000000002030000000000000000000000000000030400000000000000000000000000000405000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000102000000000000000000000000000002030000000000000000000000000000030400000000000000000000000000000405000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000010101010101000000000102000000000202020202020000000002030000000003030303030300000000030400000000040404040404000000000405000000000505050505050000000005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000102000000000000000000000000000002030000000000000000000000000000030400000000000000000000000000000405000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000102000000000000000000000000000002030000000000000000000000000000030400000000000000000000000000000405000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000102000000000000000000000000000002030000000000000000000000000000030400000000000000000000000000000405000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000102000000000000000000000000000002030000000000000000000000000000030400000000000000000000000000000405000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000010101010101000000000102000000000202020202020000000002030000000003030303030300000000030400000000040404040404000000000405000000000505050505050000000005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000102000000000000000000000000000002030000000000000000000000000000030400000000000000000000000000000405000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000102000000000000000000000000000002030000000000000000000000000000030400000000000000000000000000000405000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010102020200000000000000000000020202030303000000000000000000000303030404040000000000000000000004040405050500000000000000000000050505000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
