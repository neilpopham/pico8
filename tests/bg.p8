pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
local pad={left=0,right=1,up=2,down=3,btn1=4,btn2=5} -- pico-8
--local pad={left=2,right=3,up=0,down=1,btn1=4,btn2=5,btn3=6,btn4=7} -- tic-80

local screen={width=128,height=128} -- pico-8
--local screen={width=240,height=136} -- tic-80

function create_camera(item,width,height)
 local c={
  map={w=width,h=height},
  target=item,
  x=item.x,
  y=item.y,
  buffer={x=16,y=16},
  min={x=8*flr(screen.width/16),y=8*flr(screen.height/16)}
 }
 c.max={x=width-c.min.x,y=height-c.min.y,shift=2}
 --[[
 c.update=function(self)
  local min_x = self.x-self.buffer.x
  local max_x = self.x+self.buffer.x
  local min_y = self.y-self.buffer.y
  local max_y = self.y+self.buffer.y
  if min_x>self.target.x then
   self.x=self.x+min(self.target.x-min_x,self.max.shift)
  end
  if max_x<self.target.x then
   self.x=self.x+min(self.target.x-max_x,self.max.shift)
  end
  if min_y>self.target.y then
   self.y=self.y+min(self.target.y-min_y,self.max.shift)
  end
  if max_y<self.target.y then
   self.y=self.y+min(self.target.y-max_y,self.max.shift)
  end
  if self.x<self.min.x then
   self.x=self.min.x
  elseif self.x>self.max.x then
   self.x=self.max.x
  end
  if self.y<self.min.y then
   self.y=self.min.y
  elseif self.y>self.max.y then
   self.y=self.max.y
  end
 end
 ]]
 c.update=function(self)
  self.x=mid(self.min.x,self.target.x,self.max.x)
  self.y=mid(self.min.y,self.target.y,self.max.y)
 end
 c.position=function(self)
  return self.x-self.min.x,self.y-self.min.y
 end
 c.map=function(self)
  camera(self:position())
  map(0,0)
 end
 return c
end

function create_item(x,y)
 local i={x=x,y=y,hitbox={x=0,y=0,w=8,h=8,x2=7,y2=7}}
 i.add_hitbox=function(self,w,h,x,y)
  x=x or 0
  y=y or 0
  self.hitbox={x=x,y=y,w=w,h=h,x2=x+w-1,y2=y+h-1}
 end
 return i
end

function _init()
 p=create_item(40,40)
 p.camera=create_camera(p,192,192)
end

function _update()
 if btn(0) then p.x-=1 end
 if btn(1) then p.x+=1 end
 p.camera:update()
end

function _draw()
 cls(0)
 pal(15,0)
 camera(0,0)
 map(32,0,0,0,16,16)
 p.camera:map()
 camera(0,0)
 print(p.camera.x,0,0)
end

__gfx__
00000000bbbffff533bb33b35ffffbbbfff44fff00000000000000003bffff54fff1ffff0000000000000000000000000000000033333bb3ffffffff00000000
000000003bff44ffbbbbbbbbff44ffb3f54444f400000000000000003bf44ff5f1fff1ff054050500300030354444044001000003bbbbbbbffffffff00000000
00000000bbf544ffbfffffffff445fbbf54444ff0000000300000000bbf544ffffffffff045050400b0b0b035444404400000000bbbfffffffffffff00000000
000000003bf55ff4ff44f54f4ff55fb3ff55fff400000003000000003bf544ff1fff1fff040050400b0b0b0055440440000000003bff444fffffffff00000000
000000003bfffff5f544f5445fffffb3fffff44f0000000000000000bbff5ff4ff4fff1f040050400b0b0b0055550300010010003bf54444ffffffff00000000
000000003bff44ffff5fff54ff44ffb3f544f54f000000030000000033fffff5ffff4fff045500500330030030000b0000000000bbf54444ffffffff00000000
00000000bbf544f4ffff4fff4f445fbbf544ffff000000000000000030f544fff44fff44040000000b00000030000b00101001003bf54444ffffffff00000000
00000000bbff5ffff4ffff4ffff5ffbbff5ff5f4000000030030303300f54ff4f54f4f5405000000030000000000030000000000bbff555fffffffff00000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3b333bb3bb0dd01033bb33b310101010000000000000000000049400100100110000000000000000000000000000000000000000000000000000000000000000
bbbbbbbb3b055001bbbbbbbb0101000005550000000000000049e940001001110000000000000000000000000000000000000000000000000000000000000000
bb000000bb05501000000000100000000555033000000003049e9e94010011100000000000000000000000000000000000000000000000000000000000000000
3b05dd603b00000155d055d00100000005550330000000034969e9f9100111000000000000000000000000000000000000000000000000000000000000000000
3b0555d03b0dd01055d055d010000000000003300000000096769f94001110010000000000000000000000000000000000000000000000000000000000000000
bb0555d03b055001000000000000000000000000000000034969f940011100100000000000000000000000000000000000000000000000000000000000000000
3b0155d0bb05501010101010100000000033333000000000049f9400111001000000000000000000000000000000000000000000000000000000000000000000
bb000000bb0000010101010100000000003333300000000300494000110010010000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000000000000000000000000000000000000000000000000373737373737373737373737373737370000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000373737373737373737373737373737370000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000373737373737373737373737373737370000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000373737373737373737373737373737370000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000373737373737373737373737373737370000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000006060006060006000600000000000000000000000001000000373737373737373737373737373737370000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000050d020202020202020200000000000000000000000000000000373737373737373737373737373737370000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000005010e0e0e0e0e0e0e0e00000000000000000000000000000000373737373737373737373737373737370000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000606000606010e0e0e0e0e0e0e0e00000000000000000000000000000000373737373737373737373737373737370000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00050d02020202040e0e0e0e0e0e0e0e00000000000000000000000000000000373737373737373737373737373737370000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0005010e0e0e0e0e0e0e0e0e0e0e0e0e00000000000000000000000000000000373737373737373737373737373737370000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000010808080808080808080808080800000000000000000000000000000000373737373737373737373737373737370000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000a000a090b09000900000000000000000000000000000000000000000000373737373737373737373737373737370000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000373737373737373737373737373737370000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000060600060006060006000600000000000000000000000000000000000000373737373737373737373737373737370000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00050d0202020202020202020202020200000000000000000000000000000000373737373737373737373737373737370000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000010e0e0e0e0e0e0e0e0e0e0e0e0e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0005010e0e0e0e0e0e0e0e0e0e0e0e0e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000501080808080808080e0e0e0e0e0e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000a0b00090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
