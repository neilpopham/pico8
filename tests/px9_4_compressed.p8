pico-8 cartridge // http://www.pico-8.com
version 43
__lua__

s1="◝◝◝♥◝◝◝♥やかヘサヌ⬅️ロ░エぬ☉★ナりも█く⬅️ゅ░ニくゆロ◝セっみスˇ☉のヘニ⧗ュしっユカ◝◝♥ん★ゅ◆まヌナ█♥ユ██♥ョ◝ト▤⬆️トユし☉る⬇️ヲ…れん◜◝せ😐🅾️▒⬆️⬆️ヲ⧗るこヲ█♥ゆニ◝は◜◝いム◝よけヒ…さ█さら⬇️ン█る∧⬆️웃るこむ█ノ✽…░♥も█웃🐱らユ◆へˇ☉ラ█キオれせヲょ…ニね☉をユ⬅️🅾️りオく🐱▒★ュ▒かユ☉テ▤▤ナ▒う█ナか██ユ◆█ナ▒ナトれ♥ニん…░♥ユく●◝██웃◜★さっくヲいきく▒█ユせ░んユ▒む…☉る⬇️█ひ…チ➡️█◜◝◝せ★モラトニ♪さ🅾️ントユ◝∧のンむュク…ニ♥➡️░◜▤ュトわろ◝いニ▥ま✽➡️◜▤ュよ♪り◝⬅️のロ✽るムヌかンよマスよフネもっかノュ◝ほれツはケせのホュ➡️ヲよ▥レ◝しほュしめノ∧◜イ◝よ▥◝せ☉ユ⬆️♪へニエり◝つてヌ◝웃ちゆ▥ホっュかくヲよらん☉れクュいフ●●み…ヨ◝くヲせちゆ●◝エ★…うるうケネてン◝りトユよチンほけるわムけノ➡️⧗ヲ◝ナぬュヲ◝なち🅾️➡️◝◝ヨ⌂は♥🅾️웃かり◝◝ヒさゅか☉웃◆さュ◝せゅ⬅️トろょう●◝トれ◝んニ➡️く⧗…ノほヌ◝にるヨ◝を░◆あろヲっ…せっ◝ょ★おふルト⧗🅾️ヨン♪ちう☉…▥よゅン◝こけ░⬅️ユヤく▒もヲひ🐱▤▒にゅラ◝るさ★♥█◝♥ヲ✽░ウ▒ロりぬ🐱◆ャ⬆️ュセ☉る▒☉◜トき☉っこまさ▤▤のナれ♥ハ◝さけ…░웃を◝にラ⌂み…⬅️り⬇️かモニエノら⧗ヲよ❎➡️🐱ニふノ▥ュカナかさ█ニれユ◝●♥●░❎ろ…●るムリヨエニつオ🐱せユ◝⬇️♥なュスすヌ❎⬅️ュクフスねき░ま♥◝シ▒⬅️なり♪る●◝ヌラ…🐱ネゃ◆よフハ…のひオ❎♥ヘみ▒セ█▥◜しけスハナ◆メヤれ⬅️…░♥るネを░あヲさュつろゃ▤▒◝ナ◝◆∧ヘっュ☉りく▒ラき☉を●❎⬇️んムふセユ❎ラネトホニまキゃヘら█らすて…😐っ░エさするユ♥😐せゅぬうり█ワ░セて★➡️…ノユくま█ゃヘ●れ☉ュこ★ワアせスユ⌂あュくゃ…のス░…き█まき▤すそ☉くヘさ◜➡️ヨ◝さノりエさ…くヘ⧗さ░ゃ☉░ヘたケれとぬ🅾️♪ナ◆ムヲ⬅️おンやぬもも🅾️セュヌこ∧➡️っきちむゃニネュユっモハ▥やニおうアこあ◆せョクみうおンュさ😐ワュおほ◆ノ●ちレスエ♥クヒき…🅾️くキエひシキ웃웃ムゆ◜◆さッくノエるかアすけ😐ナキ웃웃ょノススナヒフ✽ノオ∧ホュからユ♥う★🅾️キ웃シっせ★する😐みし★さるˇ➡️っノくる⧗●◝⧗ふんっせ★♪🐱ニかなナ●🐱ひウるュラチヒぬ●ミ🐱😐か◜ハけつ🅾️ラねんろさ…るか⬆️ぬ☉みロめヘしマはいつケマワアユ웃∧ュしテ❎ュょネ▥シ★コま⬆️あぬはぬ♥ヨまムヨュスレホシウラま⌂アゃう⬆️ニッ웃🐱ュくチさ★うラユっれヒくメヨセせ➡️✽いムそャまンっやゆヨヌんん⬆️ノレンさ⬆️ん░くおの웃シうて★ニフ◜░ひヌる░◆❎ケさ∧マクゃ♪🅾️てこ🅾️あトはるルンマろすト▤か⬅️🅾️なシひノ❎ツほふヘ░るおす🅾️▒るょ◆エハな∧トネあセに🐱▒っンっフヌってに⬅️★ろもうあ◆♥ゅけさヲヒぬおきろ…ラルゅも⧗われゆョ🅾️オフフワも▤ヨリ★なャヲ☉웃ねリ▤🅾️ょワわけ⬇️もうんシに🅾️█ゃルこのリや…タヤまンひやしへこソモんノはˇひランさ▤⬅️♥ミ☉ニりネ➡️シゆ▥ツンッタ♥⧗♥ヤこは웃シお◆イ◜ウょこへめうルくユユホもかはン∧ハホ🅾️▥ゃリう◆ねっまなッ😐まモろ◝♥ャノ✽ラ▥ょ⬇️ンき🅾️ンもろんメ▒ひウン▒◆かヤハンつなヨアミャノんゃミハゆゆ➡️みもスほサ⧗☉シヲえ☉エラせムあニミやにタはか◆ロセロルラそななやヒ▥ニッヲモたウエ◆ヤクヲ⌂か▒ハめテホエフセなミフンゅんつの🅾️ュんˇミフケんワゆちさサうるレんエフ🅾️♥みヒクャえチ▤ホホんのハみめもすノょヲ➡️に◜トてトフル➡️❎ンセに➡️さラ▤ネこキウみゆムャケすつアノらちセウ……▥★ヌキやタはお◜★カりハレス▤ノウんッてて∧エモな♥웃イよヘネお🅾️ナりすう▥ゅノち♥やままノレ⌂◜ニみしツて▤をアルゃ█を♪なシヒしおみえなヨっ♥て★ぬいロチゅネ➡️⬇️ラっんモいフスよユ▤うヌいア⬆️ヌねウ◆ゆのれヲろほヌラゃんうヒワ▥ヨソねろノ⧗ょきち🅾️ヨ▤フよスキュ🐱ルき☉∧せキをろメ⧗ろりのはのセふ★まっナマれらぬなのりノコゃンタ☉ニミ✽れきス⌂ねっ▤おキそおす…ろ☉け░⌂🅾️おレ➡️✽ん░さいみ☉アヲ⬅️♥ロ☉け◆もえへ★🐱▤♥て⧗웃ねレカエもスも🅾️クょヲ➡️ンえへ웃マねさサや웃ニにも🅾️웃ヌャ☉ウれろ⬇️❎웃🅾️🅾️エれえチおヲさオモゃ░ˇ웃ゃナりみっりこミ●⧗る▒フユ😐🅾️ュ▒エふま▤セマらっこル▥🅾️けやうヨナ⧗ねさ★ゃさツお★…▤んイこヘひエきン⬇️のょも★てまさっす✽▤🅾️なみっま█うまロ➡️∧くナネワねる●へめっにンス◆ゃも◜らトユまュなニろニ⬇️イそセ★…ゃ☉フう🅾️⌂★ん⬅️やう🅾️にしユょさなメムう🅾️ソョき…ュ◝みュヲ▤るキˇ∧🅾️ミまスゆすハおなろュヒた∧メこスたふホ☉🅾️ゃネし⧗んコ⬇️ャよ█ものついホうのんひ∧ャさる☉て❎なニし∧∧せムッ⌂け▤イなしかヲ♥ンめやな⧗きムネあんれろム⌂★りム☉イフリゃソ♥ちャまムナこッセゅせえ🅾️ヨセかまュれナ▥ラチを…ゅム★うらえケフニきすひおれフく★ヌニ➡️イわコネニ☉⬅️しエ웃ムかろろ◝カニサせロ✽おょア⧗ニねフノ★へんひ▥★っ●ンルおりニしけ◜ねヤヤリる░ちノラヨきリヲす◆ん⧗め…ょイモすッ😐★♥ヨるユねゃワろ◆웃のエワフのニレ⌂りよらチうゃ█れえうちすリみすンろつ◆エしてヘタらウう░ト◜ラそカヨっむお★な◆ョシスはうにんヒわムセんフ🅾️さ🅾️くッ⬅️けらっうラタやスっヤニ⧗にテッ➡️フム🅾️ルまラ◝フッムへふっえア●し▥웃わ…セリ🅾️ムぬへヨそャくれうなロスっマこ★ヲワユリ⌂웃けロ◆ヤノも◆ょムるセぬセさ☉❎かテンオねりゆしナノヒˇ🅾️さ●♥웃フよっヘユテアとううおんれノヒ░けムコキコなけるロの🅾️ちゅせへシ…くヌ∧🅾️⬆️んムこなッよウかょすおょゆソツとトみフカエろうさワまノˇ♪セクかきンホす▥ふタ☉⬅️んホゅホこナャ◆ゆゃネンニてなゃすりヒキゃホチろぬんっテのりフ★りと❎みのエ█ロカっノ➡️🅾️ニ⬅️ウ◝…😐❎キひせすに♪♥웃んちそホ⬆️ゅぬののかんそ◆エあシっロ⧗トんロ⧗∧たお⬆️んエゅフ◜こヘ◆ゃえおケ⬇️にムラセうけヒあ➡️ホヒマソ➡️フラ…フっ☉おヨはエけをら♥みしれュゃぬほとょまメマこっゃ♥ヲろム◝りアヒヨまうヒカんネ➡️ロヲノくさこュあエひラ➡️いエわこュキんか▥むン▤いゃ⬇️やらむ➡️モ웃ラきうオあしヲセおなんネネリスおロラま♪けキシへチヌワゅミ❎セネ◝んス⬇️イやノヨはんょフンンとハフヌこ★タ⬅️ゆゃにャむうケえタレょオ★エ⬇️웃ょコ⬅️ろ◜れれアトっろ…けロヨままハノ⧗ハクんへお🅾️ンっせロ☉ホッやノはタてスムっせ◆シネヨスュなチヲムュけかょも⧗♪◜るノネもラマチサてにタ⬆️ウヲセへウセみノふ♪ヨねゆも🅾️イょとよめチのヨ⌂みさけほトナせを◝さ★へ➡️ね🅾️そホヲノリユっこ⧗❎かる☉ヌヨ▥みっツものすラホせク◆けラナヨゃすのウっノよチをれ웃🅾️ャまえチのチ▤ゃ⬇️ゆホゅ♪♥オウんウモリ▤ゆノもノヨユンツゆむょわセっフレ♥ンヲ◆なつか❎ろ◆ゃる█🅾️やわきさっ░ク♥ゆッャュさちユヨっミヨナねャもノ◆お♪トっヤ❎◆ャハヨア➡️レフタ⬅️◆ラゃ⬅️❎なねコッ⌂タ…セルイヤリャメ⧗イさ∧そホこ★♥ヨそリむホヤクネこソワチュにむね웃フさおッンツゆチろ◜ラセせ⌂ゆやうラユゃチ●のヌにッッっイおサヤむんチラミへトラむョヌつウヤよみとょすチヌ⧗のニ♥マきらほツケケソうテた♥むヤネハハふトミけ🐱エうおはんんせキ◜へ♪キ▥▒みなかエリミれうケヤˇエゆハたワノカフリクシうウャチまハなシミのちうメレ⧗は⧗トュにラねヨそょュムヨユンしナヨ♥ホ➡️る◝とゅヲホむうけメ▥ゃんネねんぬ웃そやセ★よチゃオ🅾️はメフ▥ひュゆシユゃ☉◜❎め…みひチむゃンエこう◆シニつノニネ★ョネネ⌂ラハ➡️テかみケヤテはエ░れ♥よョ✽クスすキお⧗め◜ゅゃ➡️ト…ヨてトかあゃて😐웃ヤわこわとふアさをっホゃ⧗んせ★ロ☉ネ▒ル▒なケハレセ∧ム❎フよあておキョケとえサしせひのもすュュすゃ⬅️웃レヨヨユソヨっんはユケ🅾️ホてうあュるトすてなれノ⧗れ▤んルち★こ🅾️ゃっハ█っわチっ…をにうヒこ🅾️ょハけヲれイキゃもユシレニラこさめミヲさヌね웃ゆミレ😐★ゃ▤웃らヤりせキんみやャモュ★☉せロシるえ☉⬇️ねアヒサも★ン◜◆しもヨ♥イネ∧めルニおリやルシイ●◝ふ⌂⬅️ク∧ヨセとる▥ニ⧗かよ░なく➡️ふエヒね♥フおロそソラトノろ▤ゃぬサミよミ⬅️⬅️れこらこエタろ★ょムˇねミ⬇️ょノにいノ░ら★⬅️れかマせ★웃しおゃチあタこエんとほ♪イノサへラエセハ❎ルっ…★➡️ノみヲゃ⬅️➡️けこな😐ッヘうッょしをえ😐➡️ねロシタろムっゃ⬇️웃のおンかエおおエん♥エよンっこ∧▒➡️◝웃◜あおヨたなもヌャワュよサよコかゅこま…チまんフよえるほヲんユ◝웃◆◜☉ュ◝きヲ▒ま░ネ◝く◜ょミユら█せゅ⬇️ハわラ◝★◝◝ˇナりラ◝◝んユノ◝る◝◝ネニ◝んユ◝かアかラ◝こマ◝よヘ⌂ュせヲ◝くヌリ◝かをヨ◝ゅせラヨ◝◝◝◝きヲ◝◝◝よ…ュ◝◝⬇️█"

function px9_sdecomp
(
    x0,y0, -- where to draw to
    src,   -- compressed data
    vget,  -- read fn (x,y)
    vset   -- write fn (x,y,v)
)
    local function vlist_val(l, val)
        -- find position
        for i=1,#l do
            if l[i]==val then
                for j=i,2,-1 do
                    l[j]=l[j-1]
                end
                l[1] = val
                return i
            end
        end
    end

    -- bit cache is between 16 and
    -- 22 bits long with the next
    -- bit always aligned to the
    -- lsb of the fractional part
    local cache,cache_bits,i=0,0,1
    local function getval(bits)
        while cache_bits<16 do
            -- cache next 7 bits
            cache|=(((ord(sub(src,i,i))) or 0)&127)>>>16-cache_bits
            cache_bits+=7
            i+=1
        end
        -- clip out the bits we want
        -- and shift to integer bits
        local val=cache<<32-bits>>>16-bits
        -- now shift those bits out
        -- of the cache
        cache=cache>>>bits
        cache_bits-=bits
        return val
    end

    -- get number plus n
    local function gnp(n)
        local bits=0
        repeat
            bits+=1
            local vv=getval(bits)
            n+=vv
        until vv<(1<<bits)-1
        return n
    end

    -- header

    local
        w,h_1,      -- w,h-1
        eb,el,pr,
        x,y,
        splen,
        predict
        =
        gnp"1",gnp"0",
        gnp"1",{},{},
        0,0,
        0
        --,nil

    for i=1,gnp"1" do
        add(el,getval(eb))
    end
    for y=y0,y0+h_1 do
        for x=x0,x0+w-1 do
            splen-=1

            if(splen<1) then
                splen,predict=gnp"1",not predict
            end

            local a=y>y0 and vget(x,y-1) or 0

            -- create vlist if needed
            local l=pr[a]
            if not l then
                l={}
                for e in all(el) do
                    add(l,e)
                end
                pr[a]=l
            end

            -- grab index from stream
            -- iff predicted, always 1

            local v=l[predict and 1 or gnp"2"]

            -- update predictions
            vlist_val(l, v)
            vlist_val(el, v)

            -- set
            vset(x,y,v)

            -- advance
            x+=1
            y+=x\w
            x%=w
        end
    end
end

-->8
-- px9 decompress, mem or str
-- 320 tokens

function px9_decomp
(
    x0,y0, -- where to draw to
    src,   -- compressed data
    vget,  -- read fn (x,y)
    vset   -- write fn (x,y,v)
)
    local function vlist_val(l, val)
        -- find position
        for i=1,#l do
            if l[i]==val then
                for j=i,2,-1 do
                    l[j]=l[j-1]
                end
                l[1] = val
                return i
            end
        end
    end

    -- bit cache is between 16 and
    -- 31 bits long with the next
    -- bit always aligned to the
    -- lsb of the fractional part.
    local cache,cache_bits,i,cachemore=0,0,1
    if type(src)=="string" then
        cachemore=function()
            -- cache next 7 bits
            cache|=(((ord(sub(src,i,i))) or 0)&127)>>>16-cache_bits
            cache_bits+=7
            i+=1
        end
    else
        cachemore=function()
            -- cache next 16 bits
            cache|=%src>>>16-cache_bits
            cache_bits+=16
            src+=2
        end
    end

    local function getval(bits)
        while cache_bits<16 do
            cachemore()
        end
        -- clip out the bits we
        -- want and shift to
        -- integer bits
        local val=cache<<32-bits>>>16-bits
        -- now shift those bits
        -- out of the cache
        cache=cache>>>bits
        cache_bits-=bits
        return val
    end

    -- get number plus n
    local function gnp(n)
        local bits=0
        repeat
            bits+=1
            local vv=getval(bits)
            n+=vv
        until vv<(1<<bits)-1
        return n
    end

    -- header

    local
        w,h_1,      -- w,h-1
        eb,el,pr,
        x,y,
        splen,
        predict
        =
        gnp"1",gnp"0",
        gnp"1",{},{},
        0,0,
        0
        --,nil

    for i=1,gnp"1" do
        add(el,getval(eb))
    end
    for y=y0,y0+h_1 do
        for x=x0,x0+w-1 do
            splen-=1

            if(splen<1) then
                splen,predict=gnp"1",not predict
            end

            local a=y>y0 and vget(x,y-1) or 0

            -- create vlist if needed
            local l=pr[a]
            if not l then
                l={}
                for e in all(el) do
                    add(l,e)
                end
                pr[a]=l
            end

            -- grab index from stream
            -- iff predicted, always 1

            local v=l[predict and 1 or gnp"2"]

            -- update predictions
            vlist_val(l, v)
            vlist_val(el, v)

            -- set
            vset(x,y,v)

            -- advance
            x+=1
            y+=x\w
            x%=w
        end
    end
end


px9_decomp(0,0,s1,pget,sset)

cls()
x,y=0,0
for s=0,255 do
    spr(s,x*8,y*8)
    x+=1
    if x==16 then x=0 y+=1 end
end
repeat until false