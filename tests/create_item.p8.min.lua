local a={left=1,right=2}local b={air=1,ground=0.8,gravity=0.15}function round(c)return flr(c+0.5)end;function create_item(c,d)local e={x=c,y=d}return e end;function create_moveable_item(c,d,f)local e=create_item(c,d)e.dx=0;e.dy=0;e.max={dx=1,dy=2}e.ax=f[1]e.ay=f[2]e.is={grounded=true}e.anim={init=function(self,g,h)for i in pairs(self.stage)do for j=1,2 do self.stage[i].face[j].fcount=#self.stage[i].face[j].frames end end;self.current:set(g,h)end,stage={},current={reset=function(self)self.frame=1;self.tick=0;self.loop=true end,set=function(self,g,h)self.reset(self)self.stage=g;self.face=h or self.face end},add_stage=function(self,k,l,m,n,o,q)self.stage[k]=create_stage(l,m,n,o,q)end}e.draw=function(self)sprite=self.animate(self)spr(sprite,self.x,self.y)end;e.animate=function(self)local r=self.anim.current;local g=self.anim.stage[r.stage]local h=g.face[r.face]if r.loop then r.tick=r.tick+1;if r.tick==g.ticks then r.tick=0;r.frame=r.frame+1;if r.frame>h.fcount then if g.next then r:set(g.next)h=self.anim.stage[r.stage].face[r.face]elseif g.loop then r.frame=1 else r.frame=h.fcount;r.loop=false end end end end;return h.frames[r.frame]end;return e end;function create_controllable_item(c,d,f)local e=create_moveable_item(c,d,f)e.update=function(self)local h=self.anim.current.face;local g=self.anim.current.stage;if btn(0)then self.anim.current.face=a.left;if h==a.right then if g=="still"then g="walk"end;self.anim.current:set(g.."_turn")elseif g=="still"then self.anim.current:set("walk")end;p.dx=p.dx-p.ax elseif btn(1)then self.anim.current.face=a.right;if h==a.left then if g=="still"then g="walk"end;self.anim.current:set(g.."_turn")elseif g=="still"then self.anim.current:set("walk")end;p.dx=p.dx+p.ax else if p.is.grounded then self.anim.current:set("still")p.dx=p.dx*b.ground else p.dx=p.dx*b.air end end;p.dx=mid(-p.max.dx,p.dx,p.max.dx)p.x=p.x+round(p.dx)end;return e end;function create_stage(l,m,n,o,q)local i={ticks=l,loop=m,face={{frames=n},{frames=o}},next=q}return i end;function _init()p=create_controllable_item(63,63,{0.05,-1.75})p.anim:add_stage("still",1,false,{16},{17})p.anim:add_stage("walk",6,true,{18},{21})p.anim:add_stage("jump",6,false,{18},{21})p.anim:add_stage("fall",6,false,{18},{21})p.anim:add_stage("walk_turn",4,false,{21,19,22,16},{18,19,20,17},"walk")p.anim:add_stage("jump_turn",4,false,{0,0,0},{0,0,0},"jump")p.anim:add_stage("fall_turn",4,false,{0,19,0},{0,19,0},"fall")p.anim:init("still",a.right)end;function _update60()p:update()end;function _draw()cls()p:draw()print("current.frame:"..p.anim.current.frame,0,10)print("face:"..p.anim.current.face,0,0)print("tick:"..p.anim.current.tick,0,20)print("dx:"..p.dx,0,30)end