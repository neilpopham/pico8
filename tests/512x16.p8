pico-8 cartridge // http://www.pico-8.com
version 43
__lua__
_mget = mget

function mget(x, y)
	if x < 0 or y < 0 or x > 511 or y > 15 then
		return _mget(-1, -1)
	end
	return _mget(x % 128, y + 16 * (x \ 128))
end

plr = { x = 64, y = 24, w = 8, h = 8 }

function _update60()
	local dx = 0
	local dy = 0
	local speed = 3
	local hit, tx, ty

	if btn(1) then dx = speed end
	if btn(0) then dx = -speed end
	if btn(3) then dy = speed end
	if btn(2) then dy = -speed end

	-- check horizontal movement
	hit = false
	for px in all({ plr.x + dx, plr.x + plr.w - 1 + dx }) do
		for py in all({ plr.y, plr.y + plr.h - 1 }) do
			tile = mget(px \ 8, py \ 8)
			if fget(tile, 0) then
				hit = true
				break
			end
		end
	end
	if hit then
		-- stop player right next to the tile
		plr.x = dx > 0 and (plr.x + dx) \ 8 * 8 or plr.x \ 8 * 8
		-- no more movement
		dx = 0
	end
	plr.x = mid(0, plr.x + dx, 4088)

	-- check vertical movement
	hit = false
	for px in all({ plr.x, plr.x + plr.w - 1 }) do
		for py in all({ plr.y + dy, plr.y + plr.h - 1 + dy }) do
			tile = mget(px \ 8, py \ 8)
			if fget(tile, 0) then
				hit = true
				break
			end
		end
	end
	if hit then
		-- stop player right next to the tile
		plr.y = dy > 0 and (plr.y + dy) \ 8 * 8 or plr.y \ 8 * 8
		-- no more movement
		dy = 0
	end
	plr.y = mid(0, plr.y + dy, 120)
end

function _draw()
	cls()

	local tx = plr.x \ 8 % 128
	local ty = plr.x \ 1024 * 16 + plr.y \ 8

	camera(plr.x - 60, 0)
	map(0, 0, 0, 0)
	map(0, 16, 128 * 8, 0)
	map(0, 32, 256 * 8, 0)
	map(0, 48, 384 * 8, 0)

	spr(18, plr.x, plr.y)

	camera(0, 0)
	print('x ' .. plr.x, 0, 0, 7)
	print('tx ' .. tx, 64, 0, 7)
	print('ty ' .. ty, 96, 0, 7)
end

__gfx__
00000000222222223333333311111111777777777777777777777777777777770000000000000000000000000000000000000000000000000000000000000000
00000000222222223333333311111111766668877888888778888887786666870000000000000000000000000000000000000000000000000000000000000000
00700700222222223333333311111111767777877677778776777787787777870000000000000000000000000000000000000000000000000000000000000000
00077000222222223333333311111111766666877888888778888887788888870000000000000000000000000000000000000000000000000000000000000000
00077000222222223333333311111111767777877877776776777787767777870000000000000000000000000000000000000000000000000000000000000000
00700700222222223333333311111111767777877877776776777787767777870000000000000000000000000000000000000000000000000000000000000000
00000000222222223333333311111111766666877888888778888887766666870000000000000000000000000000000000000000000000000000000000000000
00000000222222223333333311111111777777777777777777777777777777770000000000000000000000000000000000000000000000000000000000000000
00000000aaaaaaaa7777777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000aaaaaaaa7777777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000aaaaaaaa7777777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000aaaaaaaa7777777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000aaaaaaaa7777777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000aaaaaaaa7777777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000aaaaaaaa7777777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000aaaaaaaa7777777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
60603010201030301010103030103030102030302030103030302030303030303030303030103010203010303010203020202010303030303030203030201020
30103030103030301010303030103030101030303010303020301030301030303030203030203020103030303030303010203030303010302010302030303020
60603030203030303030303020203010303030203030203010303030203030303030301030302030303020203030303010203030102030301030301030303030
10203030203030303030302030303030302020303030303030301030103030203030303030303030101030303030303010102010303030303030303010303030
10201030303030303030303030301030303020303020301010202030303020302030302020101030302030303030303030303020103030103030303020302030
10103030303010103030303030303030303030103030303030303020302010301030303030302020203030303030103020103030302010202010103030303010
10302010103030303030303030101030201010303030301010303030303030303030203030303030303030301020203020103030302010103030201030303030
30303030303010301030302030203010303020303030303030303030303010101030203020101030303030303030103020303020303030301030303030203030
20103010301030303010303030303010303030303030303010303010303030301020302030301030303030303030303010303030303030303010301010303030
30302030103030303030303030101030301030303030303030303030303030201030303030203030303030303030103030303020103020102030203030303030
30103030302030303030203030302030303030301111111111111111111111111111111111113030303020303010301030303030302030303020103020303010
10203020301010303030302030103030303030303020301030103010103010303030303030203030203010301030303030203030301030102030301010303010
30303030303010302020103030303030302030301030203030303030302020301030201030302020103030101030302030203030203020303030101030103010
10303030303010302030303030103030302020203030301020303030103030302010301030101030103030102030302030303010303030203030303030303030
30303030301030303030303030303030303030201020103020303030103020102010303010301030202030301010301030303030301020303010203030303030
30203010103010303030203010303030103030303020303030303010203030203010303030303030303010103030301010301010301010303010301030302030
11111111111111303011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
30203020303030303030301010102030202030303030303030203030303030303010303030301020303030303030303030302030301020203030303010201030
10301030103020303030301010303030102020303020303030303030303030303030201030303010303030303030103030301030201010303030301030301030
30302030303030303030303020303010303010303030303010303030301030303020203030303030303030303030303030102010203030303030303030303030
30302030103010303010303030203010303030303030303030303010303030103010303020203030303030202020203030203020203010303010303010303020
20203030303030303030303030303010303030302020303030302030303020303030203010302010103030102030303010303030201030203030203030303010
30303010301030103010103030102030303030303030302030103020101030303030301020303030203030202010303010103030303030203030203030303020
30301010302030302030303030303030203010101030303030103020303010303030303010101030103010103030301030103030303020303030303010303030
30303030303030303030302030103030203030303030301010103010303030303030201030201030302020301010303030301030301010103030301030303030
10303030302030301030303030103010303010301020301030303030303030302030303030203030303010303010303020301030303030103020303030303030
10303030303030103020303010303010303030303010303030203030203030303010303020103030301030303030303030303020303030301030301030303010
30203030302030301030303030303010303030303030301010303030302030303010303030101010302030203030303030303030103030103010303030303030
10303010302030302030103030203030203030303030102030303020301030303030302030303030303020302030303030303010301010303030303010303030
30203030302010301030203010303030302030303030203030301030303030103030301030303010303030203010303030201030303010303030303030103030
30203030303030303030302030303030103030303030303030203030203030303010303020301030303030203030203030303010301020102020302030303030
70702030303020302030303030103030302020302030301020303030201020102030203010203030301010303010301030303030303010303030303030301030
30303020303030303030303030103030303030301030303020303020303030303020303030303020203020302030301010303030303030301030303020303030
70703030303030101030203030203030301030303030101030303030303030301010103030303030303030303030303020101030303030303030303030201030
10103030303030303030303030301010301020303030103020303030101030303010303030303030303020301030303030303010102020302030303030303030
10103020303030302030303030303010301030303030303030103030102030301030303030303030303030303030102030303010303030303030302030202030
30303030303010302030303030203030303010301030303030203020101030303030103030203010302030303030103020301030303010202030103030303030
30303020303020303020103030303030303030303030302030303030201030303030303030303030301030101030303030203010303030302030202030302030
20303020303030303030103010301030303020303030301010302030303030303010302030303010303020202030302030203010303010101020303010303010
30103020303030203030303030303020303030301111111111111111111111111111111111113030101030303030303030303030303030303020303030103030
30203020303030102020303010303010303030302030301030303030302010203020303030302020303030103030101020203030103030303030303020103020
10103030203010103030303030301030303030301111111111111111111111111111111111113020203030303030303030303030301030301030301030303020
20201030303030103030303020302030303030303010303030302030301030303010302030203030203030202030303020303030303010303030203030303030
20302020303030101030303010303030301030203030303030303030302030301010303030303030303020303030302030301030303030301030302010203030
30303030201030301030303030303020302010201030303010203030302030203020302030303010302030303030303010303030303030303030303030301020
30303030303020303030302020303030303030303010302030301030103030303030103030303030303030203020303030303030103030101030103020303030
30201020301030301030303030303030301030303030303030302030203030303030103030303010303030303030203020103030303030102020303030302030
11111111111111303011111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
20102030303030103030303030302030302030303030303030303010303030302030303030203010303030203020103030303030102010301030303010303030
30302030303030101020303030301030301030101010103030303020303030303030303030303030301010303030203010303030303010303030303030303020
30103020203030103030303030303030301030303030303030303030301030303010303030301030301030301030203030303030303010303010303030303010
30303030203030303030303010302010301030302030102020303030301030303030303030303020303030303030102030103010303030302030301030303030
30302030303030303020303030301020203010301020302030302030303030203030203010303030301020203030302030303030303030301030303030203010
30303030301020203010103030203030303020102010303030302030303010303030301030303030302030303030103030102030103020203030301030101030
10303010303030303030303030303030303020301030301020303030303020301010203030303020303030303020303030303030303030203030203030203010
10303030303020103030103030303030203030303010103030101030302030303030101030303030203030202030303030303010202030103030202020303030
30302010303030303030303030302020101030201030202010303030303010201020303030303030201020302030302030103030301020303020203010103030
30303030303030303010103030303020203010303030301030303030103030303030303030301030303020103030103010203010303010303030302030203030
30303020301030303030303030301030303010303030303010203030302030103030102030302030203030303030203030103030103030302020201030302030
30201030302030303030203030203030103030303020303030302030103010203030303030103030301030203030303010303030303030303030203020203030
30303020302030303030303030303020103010303030302030303030301030303030302020303030201010201030101030303010303030302030302030303030
20303030303030301030303010301030203030203030303030203030303030302010303020302030301030301030303030302030301020301030301010303020
__gff__
0000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

__map__
0404030102010303010101030301030301020303020301030303020303030303030303030301030102030103030102030202020103030303030302030302010203010303010303030101030303010303010103030301030302030103030103030303020303020302010303030303030301020303030301030201030203030302
0404030302030303030303030202030103030302030302030103030302030303030303010303020303030202030303030102030301020303010303010303030301020303020303030303030203030303030202030303030303030103010303020303030303030303010103030303030301010201030303030303030301030303
0102010303030303030303030303010303030203030203010102020303030203020303020201010303020303030303030303030201030301030303030203020301010303030301010303030303030303030303010303030303030302030201030103030303030202020303030303010302010303030201020201010303030301
0103020101030303030303030301010302010103030303010103030303030303030302030303030303030303010202030201030303020101030302010303030303030303030301030103030203020301030302030303030303030303030301010103020302010103030303030303010302030302030303030103030303020303
0201030103010303030103030303030103030303030303030103030103030303010203020303010303030303030303030103030303030303030103010103030303030203010303030303030303010103030103030303030303030303030303020103030303020303030303030303010303030302010302010203020303030303
0301030303020303030302030303020303030303111111111111111111111111111111111111030303030203030103010303030303020303030201030203030101020302030101030303030203010303030303030302030103010301010301030303030303020303020301030103030303020303030103010203030101030301
0303030303030103020201030303030303020303010302030303030303020203010302010303020201030301010303020302030302030203030301010301030101030303030301030203030303010303030202020303030102030303010303030201030103010103010303010203030203030301030303020303030303030303
0303030303010303030303030303030303030302010201030203030301030201020103030103010302020303010103010303030303010203030102030303030303020301010301030303020301030303010303030302030303030301020303020301030303030303030301010303030101030101030101030301030103030203
1111111111111103031111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
0302030203030303030303010101020302020303030303030302030303030303030103030303010203030303030303030303020303010202030303030102010301030103010302030303030101030303010202030302030303030303030303030303020103030301030303030303010303030103020101030303030103030103
0303020303030303030303030203030103030103030303030103030303010303030202030303030303030303030303030301020102030303030303030303030303030203010301030301030303020301030303030303030303030301030303010301030302020303030303020202020303020302020301030301030301030302
0202030303030303030303030303030103030303020203030303020303030203030302030103020101030301020303030103030302010302030302030303030103030301030103010301010303010203030303030303030203010302010103030303030102030303020303020201030301010303030303020303020303030302
0303010103020303020303030303030302030101010303030301030203030103030303030101010301030101030303010301030303030203030303030103030303030303030303030303030203010303020303030303030101010301030303030303020103020103030202030101030303030103030101010303030103030303
0103030303020303010303030301030103030103010203010303030303030303020303030302030303030103030103030203010303030301030203030303030301030303030303010302030301030301030303030301030303020303020303030301030302010303030103030303030303030302030303030103030103030301
0302030303020303010303030303030103030303030303010103030303020303030103030301010103020302030303030303030301030301030103030303030301030301030203030203010303020303020303030303010203030302030103030303030203030303030302030203030303030301030101030303030301030303
0302030303020103010302030103030303020303030302030303010303030301030303010303030103030302030103030302010303030103030303030301030303020303030303030303030203030303010303030303030303020303020303030301030302030103030303020303020303030301030102010202030203030303
0505020303030203020303030301030303020203020303010203030302010201020302030102030303010103030103010303030303030103030303030303010303030302030303030303030303010303030303030103030302030302030303030302030303030302020302030203030101030303030303030103030302030303
0505030303030301010302030302030303010303030301010303030303030303010101030303030303030303030303030201010303030303030303030302010301010303030303030303030303030101030102030303010302030303010103030301030303030303030302030103030303030301010202030203030303030303
0101030203030303020303030303030103010303030303030301030301020303010303030303030303030303030301020303030103030303030303020302020303030303030301030203030303020303030301030103030303020302010103030303010303020301030203030303010302030103030301020203010303030303
0303030203030203030201030303030303030303030303020303030302010303030303030303030303010301010303030302030103030303020302020303020302030302030303030303010301030103030302030303030101030203030303030301030203030301030302020203030203020301030301010102030301030301
0301030203030302030303030303030203030303010303020303030203010303030303030303030301010303030303030303030303030303030203030301030303020302030303010202030301030301030303030203030103030303030201020302030303030202030303010303010102020303010303030303030302010302
0101030302030101030303030303010303030303111111111111111111111111111111111111030202030303030303030303030303010303010303010303030202020103030303010303030302030203030303030301030303030203030103030301030203020303020303020203030302030303030301030303020303030303
0203020203030301010303030103030303010302030303030303030303020303010103030303030303030203030303020303010303030303010303020102030303030303020103030103030303030302030201020103030301020303030203020302030203030301030203030303030301030303030303030303030303030102
0303030303030203030303020203030303030303030103020303010301030303030301030303030303030302030203030303030301030301010301030203030303020102030103030103030303030303030103030303030303030203020303030303010303030301030303030303020302010303030303010202030303030203
1111111111111103031111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
0201020303030301030303030303020303020303030303030303030103030303020303030302030103030302030201030303030301020103010303030103030303030203030303010102030303030103030103010101010303030302030303030303030303030303030101030303020301030303030301030303030303030302
0301030202030301030303030303030303010303030303030303030303010303030103030303010303010303010302030303030303030103030103030303030103030303020303030303030301030201030103030203010202030303030103030303030303030302030303030303010203010301030303030203030103030303
0303020303030303030203030303010202030103010203020303020303030302030302030103030303010202030303020303030303030303010303030302030103030303030102020301010303020303030302010201030303030203030301030303030103030303030203030303010303010203010302020303030103010103
0103030103030303030303030303030303030203010303010203030303030203010102030303030203030303030203030303030303030302030302030302030101030303030302010303010303030303020303030301010303010103030203030303010103030303020303020203030303030301020203010303020202030303
0303020103030303030303030303020201010302010302020103030303030102010203030303030302010203020303020301030303010203030202030101030303030303030303030301010303030302020301030303030103030303010303030303030303030103030302010303010301020301030301030303030203020303
0303030203010303030303030303010303030103030303030102030303020301030301020303020302030303030302030301030301030303020202010303020303020103030203030303020303020303010303030302030303030203010301020303030303010303030103020303030301030303030303030303020302020303
0303030203020303030303030303030201030103030303020303030303010303030303020203030302010102010301010303030103030303020303020303030302030303030303030103030301030103020303020303030303020303030303030201030302030203030103030103030303030203030102030103030101030302
