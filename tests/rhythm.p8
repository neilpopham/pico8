pico-8 cartridge // http://www.pico-8.com
version 42
__lua__

local frames={
  right={1,2,3,4,5,6},
  left={17,18,19,20,21,22},
  down={33,34,35,36,37,38}
}

local pos={
  right={x=86,y=56},
  left={x=32,y=56},
  down={x=56,y=82}
}

local ongoing={}

local rate=10

function create_item(dir) 
  return {dir=dir, step=1, t=0}
end

function _init()
  extcmd("rec")
end

function _update60()
  if btnp(➡️) then add(ongoing, create_item("right")) end
  if btnp(⬅️) then add(ongoing, create_item("left")) end
  if btnp(⬇️) then add(ongoing, create_item("down")) end
end

function _draw()
  cls()
  -- this will render newer items on top, which we probably don't want
  -- for i,item in pairs(ongoing) do
  --   spr(frames[item.dir][item.step], pos[item.dir].x, pos[item.dir].y)
  --   item.t+=1
  --   if item.t==rate then 
  --     item.step+=1
  --     item.t=0
  --   end 
  --   if item.step>#frames[item.dir] then deli(ongoing,i) end
  -- end

  -- -- get a list of table indexes
  -- local idx={}
  -- for i,_ in pairs(ongoing) do
  --   add(idx,i)
  -- end

  -- -- loop through the list of indexs in reverse order so oldest items render on top
  -- for i=#idx,1,-1 do 
  --   item=ongoing[i]
  --   spr(frames[item.dir][item.step], pos[item.dir].x, pos[item.dir].y)
  --   item.t+=1
  --   if item.t==rate then 
  --     item.step+=1
  --     item.t=0
  --   end 
  --   if item.step>#frames[item.dir] then deli(ongoing,i) end
  -- end

  -- create an array of spr data and increment counters
  sprinfo={}
  for i,item in pairs(ongoing) do
    add(sprinfo,{frames[item.dir][item.step],pos[item.dir].x,pos[item.dir].y})
    item.t+=1
    if item.t==rate then 
      item.step+=1
      item.t=0
    end 
    if item.step>#frames[item.dir] then deli(ongoing,i) end
  end  
  -- now render sprites in reverse order, so oldest is on top
  for i=#sprinfo,1,-1 do
    spr(unpack(sprinfo[i]))
  end
end

__gfx__
00000000111111111111111111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000
00000000117771111177777111777771177117711777771117711111000000000000000000000000000000000000000000000000000000000000000000000000
00700700111771111111177111111771177117711771111117711111000000000000000000000000000000000000000000000000000000000000000000000000
00077000111771111777777111177771177777711777777117777771000000000000000000000000000000000000000000000000000000000000000000000000
00077000111771111771111111111771111117711111177117711771000000000000000000000000000000000000000000000000000000000000000000000000
00700700111771111771111111111771111117711111177117711771000000000000000000000000000000000000000000000000000000000000000000000000
00000000177777711777777117777771111117711777777117777771000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111111111111111111111111111111111111111111111000000000000000000000000000000000000000000000000000000000000000000000000
00000000222222222222222222222222222222222222222222222222000000000000000000000000000000000000000000000000000000000000000000000000
00000000227772222277777222777772277227722777772227722222000000000000000000000000000000000000000000000000000000000000000000000000
00000000222772222222277222222772277227722772222227722222000000000000000000000000000000000000000000000000000000000000000000000000
00000000222772222777777222277772277777722777777227777772000000000000000000000000000000000000000000000000000000000000000000000000
00000000222772222772222222222772222227722222277227722772000000000000000000000000000000000000000000000000000000000000000000000000
00000000222772222772222222222772222227722222277227722772000000000000000000000000000000000000000000000000000000000000000000000000
00000000277777722777777227777772222227722777777227777772000000000000000000000000000000000000000000000000000000000000000000000000
00000000222222222222222222222222222222222222222222222222000000000000000000000000000000000000000000000000000000000000000000000000
00000000333333333333333333333333333333333333333333333333000000000000000000000000000000000000000000000000000000000000000000000000
00000000337773333377777333777773377337733777773337733333000000000000000000000000000000000000000000000000000000000000000000000000
00000000333773333333377333333773377337733773333337733333000000000000000000000000000000000000000000000000000000000000000000000000
00000000333773333777777333377773377777733777777337777773000000000000000000000000000000000000000000000000000000000000000000000000
00000000333773333773333333333773333337733333377337733773000000000000000000000000000000000000000000000000000000000000000000000000
00000000333773333773333333333773333337733333377337733773000000000000000000000000000000000000000000000000000000000000000000000000
00000000377777733777777337777773333337733777777337777773000000000000000000000000000000000000000000000000000000000000000000000000
00000000333333333333333333333333333333333333333333333333000000000000000000000000000000000000000000000000000000000000000000000000
