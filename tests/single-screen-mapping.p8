pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
--
-- by neil popham

-- https://www.lexaloffle.com/bbs/?tid=30910
function hex(v)
  local s,l,r=tostr(v,true),3,11
  while sub(s,l,l)=="0" do l+=1 end
  while sub(s,r,r)=="0" do r-=1 end
  return sub(s,min(l,6),flr(v)==v and 6 or max(r,8))
end

function compress(level)
  local count,previous,data=0,nil,""
  for y=0,15 do
    for x=0,15 do
      sprite=mget(x,y)
      if count<16 and (sprite==previous or previous==nil) then
        count=count+1
      else
        count=count%16
        data=data..hex(count)..hex(previous)
        count=1
      end
      previous=sprite
    end
  end
  if count>1 then
   count=count%16
   data=data..hex(count)..hex(previous)
  end
  return data
end

local data={}
function decompress()
 local total,level=0,{}
 for y=0,31 do
  for x=0,127 do
   if not (x<16 and y<16) then
    local raw=mget(x,y)
    local sprite=raw%16
    local count=(raw-sprite)/16
    if count==0 then count=16 end
    --for i=1,count do
     --add(level,sprite)
    --end
    add(level,{count,sprite})
    total+=count
    if total==256 then
     add(data,level)
     total,level=0,{}
    end
   end
  end
 end
end

function renderlevel(level)
 local x,y=0,0
 local array=data[level]
 for i=1,#array do
  for j=1,array[i][1] do
   mset(x,y,array[i][2])
   x+=1
   if x==16 then
    x=0
    y+=1
   end
  end
 end
end


-- core map is 128x32 (or 256x32)
-- map will always be 16x16
-- 16x16 = 256 sprites
-- https://pico-8.fandom.com/wiki/poke (also poke2() [16 bit] and poke4() [32 bit])
-- map region is 0x2100-0x2fff
-- 128x32 is 16 full screens, or 16 levels
-- 8 bits... 0-255
-- 128 64 32 16 8 4 2 1
-- x   y  ss ss s s s s     63 different tiles, 2 available flags (or 1/2/3 tristate)

function _init()
 --poke(0x2100,1)
 --poke(0x2101,2)
 --printh(compress())
 --renderlevel(1)
 --local d=compress(1)
 --printh(d)
 --0141424381424381424381424381424381424381424381424381424381424381424381424381424381424381424341
 --02020202020202020202020202020202
 --0202321152317211421122117211721172116211821152515211023241f211c231f22192212231a231020282
  decompress()
  renderlevel(1)
  map(0,0)
end

function _update60()

end

function _draw()

end

__gfx__
00000000111111112222222233333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111112222222233333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111112222222233333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111112222222233333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111112222222233333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111112222222233333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111112222222233333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111112222222233333333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
eeeeeeee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
eeeeeeee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
eeeeeeee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
eeeeeeee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
eeeeeeee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
eeeeeeee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
eeeeeeee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
eeeeeeee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
000000000000000000000000000000000202321152317211421122117211721172116211821152515211023241f211c231f22192212231a2310202821010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
0000000000000000000000000000000010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
0000000000000000000000000000000010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
0000000000000000000000000000000010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
0000000000000000000000000000000010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
0000000000000000000000000000000010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
0000000000000000000000000000000010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
0000000000000000000000000000000010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
0000000000000000000000000000000010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
0000000000000000000000000000000010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
0000000000000000000000000000000010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
0000000000000000000000000000000010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
0000000000000000000000000000000010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
0000000000000000000000000000000010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
0000000000000000000000000000000010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
0000000000000000000000000000000010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010
