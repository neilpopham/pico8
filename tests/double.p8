pico-8 cartridge // http://www.pico-8.com
version 43
__lua__

function
    px9_decomp(x0,y0,src,vget,vset)

    local function vlist_val(l, val)
        -- find position and move
        -- to head of the list

--[ 2-3x faster than block below
        local v,i=l[1],1
        while v!=val do
            i+=1
            v,l[i]=l[i],v
        end
        l[1]=val
--]]

--[[ 7 tokens smaller than above
        for i,v in ipairs(l) do
            if v==val then
                add(l,deli(l,i),1)
                return
            end
        end
--]]
    end

    -- read an m-bit num from src
    local function getval(m)
        -- $src: 4 bytes at flr(src)
        -- >>src%1*8: sub-byte pos
        -- <<32-m: zero high bits
        -- >>>16-m: shift to int
        local res=$src >> src%1*8 << 32-m >>> 16-m
        src+=m>>3 --m/8
        return res
    end

    -- get number plus n
    local function gnp(n)
        local bits=0
        repeat
            bits+=1
            local vv=getval(bits)
            n+=vv
        until vv<(1<<bits)-1
        return n
    end

    -- header

    local
        w_1,h_1,      -- w-1,h-1
        eb,el,pr,
        splen,
        predict
        =
        gnp"0",gnp"0",
        gnp"1",{},{},
        0
        --,nil

    for i=1,gnp"1" do
        add(el,getval(eb))
    end
    for y=y0,y0+h_1 do
        for x=x0,x0+w_1 do
            splen-=1

            if splen<1 then
                splen,predict=gnp"1",not predict
            end

            local a=y>y0 and vget(x,y-1) or 0

            -- create vlist if needed
            local l=pr[a] or {unpack(el)}
            pr[a]=l

            -- grab index from stream
            -- iff predicted, always 1

            local v=l[predict and 1 or gnp"2"]

            -- update predictions
            vlist_val(l, v)
            vlist_val(el, v)

            -- set
            vset(x,y,v)
        end
    end
end

function _init()
    reload(0x0, 0x0, 0x2000)
    memcpy(0xa0,0x00,0x2000)
    -- memset(0x00,0,0x2000)
    -- memset(0x80,0,0x2000)
    poke(0x5f54,0x00)
    px9_decomp(0,0,0xa000,sget,sset)
    poke(0x5f54,0x80)
    px9_decomp(0,0,0xaa00,sget,sset)
    x=0
end

function _update60()
    x+=1
    x=x%256
end

function _draw()
    cls(1)
    camera(x,0)
    poke(0x5f54,0x80)
    sspr(0,0,128,128,0,0)
    sspr(0,0,128,128,256,0)
    poke(0x5f54,0x00)
    sspr(0,0,128,128,128,0)
end


__gfx__
ffffff0ffffff0d7cab2e0e71efff73f70fffffffc598f2cff421fff7e4e94cffe06162ffb5e0e6e6eff56abc6bd29f392ff5cabd279cf3cff0835c2371f7948
7848fa02295546b322fb1ffb18cbbd6f957846a632c18466ba2263bf39ffd429f321d684191e00e79d6ac345efc0fbacb42cb229c1fce0316c49106402fb8cff
fb06c974a16be1978c72114321ef0acfa1e729f7830824196c206913294a196a90fb1ff339f98b04872cf0850cc25879082ff62e70e7342e803e802a962dc14e
a884cf548529f99b9ff8f8e0390a2109850b8c8f04a01efff50f101e929806263422ff4584818f19790f72fd5148b248d12012cb0094c8b8ffb3898010752422
b0e9888f108082f38c7cffe2c942c71904040e80cd901acf12f738f7948628cbc290061132f34838fff3249e4cf0834091c8cd1e091ffff10c598471ec0e8463
91115cd19581ff73efb0832401e70152146940fb8c2c2cfffb80d0ff5614a35fb171ff33e76a70d9fd426448fb21905eff5cf9c5708fd26ba4cf5c7cfff70075
4ff1254431918f52c1cffff805e72a6e892d120eec48ffff0980f75818e158e01ef1efff60f325e8a04a270fb0fff732cff384811ef3efff02f001e76efffb1a
b66f4873cfff13074c609cc1784698472e8c6121966119acf2672fffb0d926128a062a6249144022744a694f79c6ff7668c299e2511fc1429382992918563dd2
2cf4cfff10ecc4c18f7c8d2c24a9409ffff241816566148487838b690222fff7621424044ca9442c0024880a5842efff0d1998388a095f8c32de09576708c61f
ff7748c142b8546c1108b239b0098dfff9a085210e24851a20c110fff782c331928546103ca2b468096800fff778f852232b1e8090722cfff1b480d011348393
802178cfffb26b06424624442904e19c248429fff7620cb3613b5d23f8542bdcfff5b0faec26abc21b4e07598fff34216980f306212290632f2fff782968170f
ac2952179c7898fff7314803421cb052b8090f1ffff901a8910ed54206c93cfff9a440324421cd98c344cd43cffff1e4e1ef84201e444c225ef78cff94842c92
fb11c119094ef78cff788522ff78b2b529488cffff190b346013cf984803232fff764ea088422d1e706048760c199f9901e0ef51c3201299680734eb01090d4c
fff301c719526980940e06438198c1288cfff780f303c188a48b421e974882fff734ef00d4880e369858a022842c280ff33ef29f583e804b03ea05210b68cff2
9f74e72e0eb84680d08724f9042cffd9fb62e31019808d421e1e1a0efff19c5122107d0f1f00d8448ffb1f78cf63b19d1b403cb99f4e901b46b48ff13ffd0400
2707bcbc680651cfffd129880a23ef46ca1d42cff95e7c94ab44661c4ef2298909d02cfffb1670062098df4802094461effc2f72e8944048f39683428442cff9
8ff31b4a5598f39c2b9690d1cef7509f8fb3210ce7c58c5bc0804b6322cff9426ff31c40432efb40444213c7cffe23fff8813433f3e1b86901a290d68fff529f
f5443014794e7396a52968c1b2fff2dff5d32984ad524e7c0bd8f2cfff9a72421d0e76227d0ff339ff9440880c1bd6b1728374ebe6190fff75c6c7fc290f66e2
c2b440b131eff6679cfb22c394458b72e9ad2047b54261efffa88cc325948f4eabc420a230ff33eff27895a21268fb2852228b0c2cff68ffd80933cf812160e2
2cffa8ffd0f3402f3d021d9033448090ffff4622232463ef9c80744469472c090ff739f79360981a10ef021699fb2cfffd09192bc443148720070d1a8d80fff1
e19f978944e24ce26c2c22d4830954a42cff28ffd429f32995832c139c29c8e290efff11f4870204b4c616c10619ffb1ff7101954e218cc3c0c9980440680fff
f288c10678cc84a07144693e4902328944848ff30ff3907dc8a540212c1c01d12b12c446bc010ffff201c19d2924e842fac50e854e952948fb9ff5c07c24a217
46974ea52ac884024a290ffb0ef75d0395ea1934ea8c31306199c5b422cffd34c44267501a98262e0c42d621111e90fbbcff12021400e194890e26125299c741
f80cfbcff36016481f03e162221040640f64a1e75ef7034019163199fb80b42294485311931290ffb6616be200e097254e9909d08acd2718ffb2719706c07483
88858442619b422718b2cff4984f98843b427d8c3b9c11bf3846bb0c51ef79001348acb987244ef7119ffb30cf0cb1e950cffe8f58ff1383214e0684c52ff42e
77eff10e00f22c1c5986290fb05efff30fb45a66b32081737d62d400ff77eb1a0c1980c204461033cb1995ce80ffb5a94e90f819b303b563e7a942b42b10ff34
e1910461a2f316901ef3c29019802c80ff7a078c300ff62ed0f78485321468460ff3a52a2742958f5338032cf351a29fa3c408fffc6bd9646cfc74284429480e
80b04e9363619538fff8493cee0d0fb8d22858b2c2174983215ef78cf2b13958602229a04c3221b6241cd659ff72f30f48b208091b4094228077220a1ef7acd8
4cc2d010167c19855524c233fa6918ff13b07c060b19746b5078cca995ce1e5efffb8e5491810c0cf40effff582d05efffffffff709a7bd562e9c16962742972
74a9de0bc6c3aa1c798fd294c6c4206d32c384e8c6bc70842349c4d42678dabead1ea44839469f722f1217c3718099991ec3c1133909c3ace1e0b1d5f9a3ebc7
fc3dc51016f78cf494e94dea89344e19409d2259094832e3d8f01c378142f5466df2b5a1138c3edc0bfb2c360872217948980695a9942a4eb7c193251b50b529
82ea3ab3eabc5515e522f756b85895c5914c3874174e0736fce0d4493c7161707e16bb67cbd7ade5f9e1aeb884df52d58488d313c766808792d440fb523d1ead
5f93ecd21d986fa4e8884df7b69982278e376ebd623f342df9f8a72c1b49477c557c56f4ae8c13e0985cefce3ce840a764a24e7211efb4a09c427c4c57c21e0b
625bea42bcf798f670f81b47b3c59972b88cfa89116746976afa8c32267029ef88e1093409a4b2a6f4621e091ffd3883069d2278bc683c7c85480ef484d29093
4a9d44398349497c6272f423e9d19c5b0e4746a2d366947ff38c3285f098571ae02287883c914e1215c42c2cc429755094c16d1cfb9a94209a8464c69429c5d0
92009034cea4e803531f3c21e819cfc809284c09e433844eb8d134294a1c87798d391fabf8663198dfc99483444239ae144ae3e50708f1ab5c624aed3c43dccf
b268988906991833cf8c91e94c0d3274ec03619fd143163ef70a7132c13c362d4f9854e36bcc8f573a22421d81e749721194834ebdc1f4735b4439e6299cf9f3
823219d169c67f0ff44266b1c5c0d95a0353b219723f76622f30fcc39ff86f1f88cf7259f35ef59f8f52cfde9ff53ff31ac11e02c5cdcfc4873cf1cffa838f31
cff38b917481ff340ffb81e040c949382879ff12fff768b8fff394839b9f8fff391eff1cfff36efb0fff8c1efff0d08f78ff94a0fff7c81ff7b0fffffff701ef
ffffff02cffff7000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ffffff0ffffff0df1ceed925a204bfffa42284872cff44acfffd1a24634342cfff751198cfacfbc4efff942090d0f71fb2d0ffff48b898c42cf2cfffbc42023c
a90885879fda112cfffd0645a727421b3694e69fffb8784aad56566198386421921ef0962efff648d1622bc213bd25a290a1270f2ffff542112b9e8c1119ce5c
22694a27ac4efff6422406fbc56213584361b4c40f8c2cfff900b5297d38b40c0f5261bacf698fff2f429f3274074251a88984942121039b878ff52f4cef1717
589563090acc39da946cfff30e946ff80f8e76e0bda9c113476b9098c52ffbf46fbd2eb4eb54e901462c1398c807acff73945e7dc70446b161426337c36e0429
fff7094621efc32fd63dc9d01642a624ae9d460efff0078dfda0e4bc662111bc89de888dc8effc3c53f8fdd83c83317ac2a1f0337c032cff870274cef4e18e12
51bc7e529a1fffd5229814e7c442b77399468128e16bb394a4cff479842210fb940118ee11f5e41422c210f21131ff3c02780046e1fb8440fc151474c005584c
1834b98ff362ea0f0f78207e5b3242988f409175e0d5412b484cffc2c50a93c5e904390bc2fd39a980b442b4e352b4a3ddff39b8335d57c490a909872936f806
1c8917078ac6b0f2f0ffb0e1e39c6f44e904e024c226fc929e3c6b5d134e833d767466394790c3cff90c393442399d1088c2e863c204c80e8f29836d8c4836a6
b4c7cffb21f42aaf954c6107c29ed44b10d6a7274b94ca0ab90639cff3145ada11611b0402bb0ea5c83429369c4442ec490c885292ff38cdee9891252cc2984c
a18f0a7443328e2d8b44b984d1af8a7a220fbf2f2c040b5c8c1f8c8c1443dc2ead0112dd11319e2f579582e17d1c40ff30fc48c04a71cc1c11644d9f8454c37d
8b7c3a8d2d4a67c0bc1e84dbcfee0f55141786ce19b4f1481f3c61bd02458f12196190f73c52c390c8340972283eb0b88d19307d6ce72942c51417425398551f
62ef0bb963296cdb019421e04690744e02dc94f0bd8a86c2c576a6a19f098fb25fb8456bcc165b477c29575c99e20c31a675858dab48fc6cf02dcbe702279e1b
84c062b8d6a93508d72631bc42cc12c217526cf02fbd294934e09384294642ef9127985a2bc4242a965c5982772e0efb5682e007a0399b3178872259d7c048ac
fd1b78f34a4d083298062002f342298552131d4c9b1752ef08c2126421e19341380e08c86c0774ed40bfa4d3cfc942942094e3f07d438f2186201d46ef014621
dc297e94278c62ea0f28346bb6b0f0f52e1abddf095abc28d29f2c1fd22abeb6a23190f71366f56e9c2fd2dc7075c5b48d14276ec0f4646174c84e1d3e0e1c1f
68f12c92f3e2c30e274c3b088c198212621f822b98d3cd0e10ce944a517529f0a09b21efcc1b781215b5e21846b4efe46704249fa9480f0c1ff8e1c1c9490698
d14ea848e480f3119e213c215118b3d72bd1903f4e0fcf246660280842c274611bae14839f8278c9b29c1e1a84c3cf299847bbfc5bbc8da9740747b91f3669ac
19883a098c3236be1098e8090fc32570bd5fdc313d4220b6e11a9295e79a475a98ca467836e970d8a0b448b4434a93a67c3880229548d2121f34a12fb8905b63
9c444684c6494e8a8cbe8e17c23f56b9ce9c44426d443368b639f98623143243e4a1b428942497b3d728467e3fc3f67c27c3903454c1bb27c19c397add6fb87e
8e84ec86ad98809d29829832abc77c39609c13d8fafce99a5409174291398519a7ad44877d7c19994c882550b369954e015d45456945b090d86e8c1fc1293b8c
1d38d4fd3e1f0c37390d41d0224eb129441de1783e1ce094a3620bd11768be87c529529d1bc17d8e257c3ea19b53b3601b44010fd6d4832f8342278469de1111
2e96fad83ea1f01bc2439c4022427058b3f02d56b01ef3975f2670a26624e9ce8d57c317c25793310787fa012f7876e090416817604aa65d52c10234479a00fd
ed36d365db29032c664a4c27435efa193a052c133b1e84c51c02744695219c17c393c627e99428c21fc1b13529b9166ef111612832e8b6b21522e9093ea81842
c17ceab4a96424699cf2cf1985648224782014ac2f8822c3178709b62f4801c1fc670aa9525909a309d3d5873bb8c8b429841234287290a32748400bc63c26f4
8c027874ee552583d2c3102c10c2b09a0911c07d21683083032c42469bf1b3636d428598468cf09a942c942629c527bc71c8c37c6956494a88c1703942090124
ded4538c80f38889400b09fa870f84b9051bc24a3719407839c129424229437f43121498f3a872274215f466a9f2802c3bc24e80fe294878b214fe42b52e0e78
586803b63b620948454e212a85de9548c16126e95c5cd1056948cf17101142ab01311b0103d702b41eec8d012f1d569df24294345e79582006c120b021b42880
ab5cf1b709812fc1a6cf490652701e71e02c2bd593e06422974e06f8867cf19d0c6c022cf41ab80928b39cf9936bcc6940fce869cf31094427039df521e29629
acd2940a99f251a483264948f3e0c4f29f298f19f2706203cd48321748b2578c19d8406f703b3e0428fb4e7848e8801e5e09911e8fca98ba849b42804b8b617d
6efa3019c48e344cf3e9c8c442e71b34ca28156c047425fc1dff408f521758f03080e7c93e021d7067112e0942930dff229437d5021250ff403b3865d2c79622
1e90f52037584b70ffd1f42bd150b2642121ed2c2129c1a9c1b64f21c5cf461efdf44759a4e090f44ec8803abc1b7219571b3219958b8fff986c6f014229018c
9d001e8993e7863dd852e9071ff3c0848cc3a16111e1c314c79a6a67d2420758321f0fff9ea476a940360073f54afa08d8c856e003e1eff47539802932091114
1e803409802906bd6ea8901e4b17484aef73d52d6668582603420036d904c6dca909cc31424e0f10cff523f5263468d5080321884a65d85c440f8e0558d59ce1
e0e0efbc2788566ca281630401404013e94784710c61011c3c52f70f79634e948400c3c28024a8c4e52278c33b42cff10cf4d16295819848c0030095852258f1
012988893c1e8f739cf3261ec16b4446024342119e2487948e480ffb00f7c442119124642107482d011830c21707d0e8463ff7c4c8be106d090748684322c728
fb2099eff33271169442082246854ef70b49448e121efc0f30f094c3309c02c31401ef727480dc2954a24eff1d16209010d0049db084cf091c40f591180ec03e
709f59524850c058020c1d42ed4c122cb74ab648f58b9f76b4e0300ac4680910d31633f2f3946b3e048378529f4e72194a022808b6850f00e1c39c5a169442e2
0f7d0705ef74424181e001c390c39874ed58fc13e0e22cf880fd4c30216048c059ff7071707b421ffd6068024b24601216588c1c5cf799b43d52e78321cfc801
e93401010b002ff32ed709327d7223b58f7803242156348c085098f58f9e08d87e10e9b0b098cf329509090313ac2806854e1e3ef204e1e040411b38fb24e100
7190b4c31694e0eff019294c21884348d0ff85e8044efb01ec01e7f409b616946c3c11efa443811c61012021a7542291ff30e976116221f708fb42280a421e1a
4e7011944271328ffbc79484b9126f2ff587b18070f1105e0ef690f71f348ff817486833184600c2240f37e8d118c9dc693844eff31e01c836699c3421f3a09f
1522701ef49e0748d0f881494229448f59c281ef21c1cfb278d8b423150748c11240b484cf1185235e0d1f079dfac5642cf2f20801580942fb808194b1292646
c395acfcc3950f68f862c217019f52132c6b6e4e39ff58c3cf21ea9004832194cf02f089c343fc2cff623f8cf510742c10a180e70a48080959bce69f39b8fb46
c721e84cf81eb9d890fb91bff29cff121742e39ac8f52139325b0ff35e76e944520e0e71ec160ef20fb1f0ff182721071ff61a0efa0f33ff30eb4c368fd5ec0f
758f98fb5ac8314746cfbd1e90fff1e1e739fd22f28f770c116c52f72f46eff4940d4c694efd4c7cd28ff874fff52ca2beccfcb08fd241000000000000000000
