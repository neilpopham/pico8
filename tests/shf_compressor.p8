pico-8 cartridge // http://www.pico-8.com
version 18
__lua__
--
-- by neil popham

-- https://www.lexaloffle.com/bbs/?tid=30910
function hex(v)
  local s,l,r=tostr(v,true),3,11
  while sub(s,l,l)=="0" do l+=1 end
  while sub(s,r,r)=="0" do r-=1 end
  return sub(s,min(l,6),flr(v)==v and 6 or max(r,8))
end

function compress(level)
  local count,previous,data=0,nil,""
  for y=0,15 do
    for x=0,15 do
      sprite=mget(x,y)
      if count<16 and (sprite==previous or previous==nil) then
        count=count+1
      else
        count=count%16
        data=data..hex(count)..hex(previous)
        count=1
      end
      previous=sprite
    end
  end
  if count>1 then
   count=count%16
   data=data..hex(count)..hex(previous)
  end
  return data
end

local mapdata={
 data={},
 decompress=function(self)
  local total,level=0,{}
  for y=0,31 do
   for x=0,127 do
    local raw=mget(x,y)
    local sprite=raw%16
    local count=(raw-sprite)/16
    if count==0 then count=16 end
    add(level,{count,sprite})
    total+=count
    if total==256 then
     add(self.data,level)
     total,level=0,{}
    end
   end
  end
 end,
 load=function(self,level)
  local t=0
  for _,block in pairs(self.data[level]) do
   for i=1,block[1] do
    mset(t%16,flr(t/16),block[2])
    t+=1
   end
  end
 end
}

-- core map is 128x32 (or 256x32)
-- map will always be 16x16
-- 16x16 = 256 sprites
-- https://pico-8.fandom.com/wiki/poke (also poke2() [16 bit] and poke4() [32 bit])
-- map region is 0x2100-0x2fff
-- 128x32 is 16 full screens, or 16 levels
-- 8 bits... 0-255
-- 128 64 32 16 8 4 2 1
-- x   y  ss ss s s s s     63 different tiles, 2 available flags (or 1/2/3 tristate)

function _init()
 --printh(compress()) printh(compress(),'@clip')
  cls()
  mapdata:decompress()
  mapdata:load(3)
  map(0,0)
end

function _update60()

end

function _draw()

end

__gfx__
0000000077777776000000000000000099999999ccccccccaaaaaaa9000000001000000100000000000000001cc77cc1cccccccc00000000aaaaaaa900000000
000000007666666d0bbbb3300000007c94644642cccccccca9999994000000000000000000000000000000001cc77cc1cccccccc00000000a999999400000000
000000007666666dbbbb777c0000087142222222cccccccc94444444000000000000000000000000000000001cc77cc1cccccccc00000000a999999400000000
000000007666666dbbbb71718288287194444442cccccccc6ddddddd000000000001100000000000000000001cc77cc1cccccccc00000000a999999400000b30
000000007666666dbbbb777c8288287c94444442cccccccc7666666d000000000001100000000000000000001cc77cc1cccccccc00000000a99999940000bbb3
000000007666666dbbbbbb338288288299999999cccccccc7666666d000000000000000000000000aaaaaaa91cc77cc1cccccccc00000000a999999400003b33
000000007666666d3bbbb3338288288294644642cccccccc7666666d000000000000000000000000a99999941cc77cc1cccccccc00000000a99999940006d330
000000006ddddddd333333332222222242222222cccccccc6ddddddd3bb77bb31000000100000000944444441cc77cc1cccccccc00000000944444440006d000
__map__
0000301760125041406100004011139011200100005015401720146041206100002011a01120010000301760125041406100004011139011200100005015401720146041206100002011a01120010000301760125041406100004011139011200100005015401720146041206100002011a0112001

--0000301760125041406100004011139011200100005015401720146041206100002011a0112001

--[[
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000700000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010100000000010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000010300000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000050000000007000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000001010101000001010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000010000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
->
00003017601250311640610000401113901120010000501540172014604120165100002011a0112001
]]
